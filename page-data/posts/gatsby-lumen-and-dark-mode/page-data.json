{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/gatsby-lumen-and-dark-mode","result":{"data":{"markdownRemark":{"id":"df34d938-d3aa-588c-995f-4b89d46870e8","html":"<h1 id=\"python-based-static-webpage\" style=\"position:relative;\"><a href=\"#python-based-static-webpage\" aria-label=\"python based static webpage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Python-based static webpage</h1>\n<p>Previously, my web presence was composed of a static page built using staticjinja, an HTML5 UP template, and\nmy own json parsing logic to build the different elements displayed. Back when I made it I had little experience with\nJavascript and no wish or need to update it continually as one does with a blog.<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> It looked something like this:</p>\n<figure class=\"float-center\">\n\t<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFElEQVQoz02QSU8UURSF+2/YIthD9chsza+rq7EZFmgCLYmogDKI2AaX/DL3unWDCQnVzLBUIggyB8jnrWqnSk5u7nv3nvrOi1mO4oHl0tVroI+P405MYA8PY5V9rN5ejEwGvbUV/U4cPR7HaGvDyGYx5c6uVHAeP8J9/gz1eg71fpFYttiBliui5dvRX0zgTk9jj4xgVauYponq7sYrFPDSGl4qTUmT2tGBb1nYJYU9NIQzNiZ7r1D1OrF7iTRtSY1kJo8x9RI1P496Oo4SSscrU7Ft+np6qIjpw3yBSjZHRQyrcq5cF3egn1KthpqcRL2ZJxYapbKFiNCcmUW9q+NNTVGuPcEbGESFi52d+MUivsT3M1k8iexK7wmlJ0l8SVQKY8/OEEtoOdJimJbY+uwczuIilhiao6OY1X4MiW3IsplKYbS0YMTvRlVPJNCLBQzLlLkq1ugIjlBGhn8I3bd1+paW8BcWKMtlWf4cEpTCt2xvR8n7uWKkkkmUUJa6uvBch/LgoCSq4QtIFDmUli/y4eMntvf3Wd3bIwi1s0OwtUWwsUFjfZ3VICBoNAiCRrOurRHIebC5SbC9TWN3NzRsEqZzBZZXVgi/s6srLq6vubi5aer2lnPpD09O+Hl5GfV/dXP7b04UEd5PZwmjf17+wqUM/Tg95ej8nGPR0dlZVL8fH/P14IBvh4fNM9HR//o9/wsyEpdWAoOMJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Old website look\" title=\"Old website look\" src=\"/static/83dd1c750330984f5183481dc8b14661/7d769/old_website.png\" srcset=\"/static/83dd1c750330984f5183481dc8b14661/5243c/old_website.png 240w,\n/static/83dd1c750330984f5183481dc8b14661/ab158/old_website.png 480w,\n/static/83dd1c750330984f5183481dc8b14661/7d769/old_website.png 960w,\n/static/83dd1c750330984f5183481dc8b14661/87339/old_website.png 1440w,\n/static/83dd1c750330984f5183481dc8b14661/f52e1/old_website.png 1831w\" sizes=\"(max-width: 960px) 100vw, 960px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n\t<figcaption>Old website look.</figcaption>\n</figure>\n<p>It worked well as I didn’t have the need to update it often, but perhaps leading to it being usually very out-of-date as\nI changed projects and workplaces.\nAdding to this, the advent — or should I say return? — of blogging and developer diaries made me want to start my own\nblog.\nThis would be where I share what I learn along the way, some tricks and tips on Python and development strategies\nthat seem to work for me. </p>\n<h1 id=\"javascript-static-site-generators\" style=\"position:relative;\"><a href=\"#javascript-static-site-generators\" aria-label=\"javascript static site generators permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Javascript static site generators</h1>\n<p>While Medium seems to be the platform of choice for these kinds of blogging, I’m a proponent of free open\nsource software and of learning-by-doing, so this was a good opportunity to learn some more Javascript, React and\nGatsby, an open source static site generator with good Markdown support.</p>\n<h2 id=\"making-it-mine\" style=\"position:relative;\"><a href=\"#making-it-mine\" aria-label=\"making it mine permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Making it mine</h2>\n<p>I have always had an obsessive relationship with tinkering and making my digital experiences as close to my liking as\npossible. A good example is <a href=\"https://darkreader.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dark Reader</a>, an open source browser extension that <em>“inverts brightness\nof web pages and aims to reduce eyestrain while you browse the web”</em>, which I currently use for handling pages that don’t\noffer a native dark mode.</p>\n<p>This website is based on <a href=\"https://github.com/alxshelepenok/gatsby-starter-lumen\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Lumen</a>, a Gatsby starter blog with a\nminimalistic and pleasing design. It does not support a dark mode out of the box, making its implementation an\ninteresting learning experience. It also seems to be a <a href=\"https://github.com/alxshelepenok/gatsby-starter-lumen/issues/688\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">request</a>\nfrom people using the starter blog, so it’s a good opportunity to help out. </p>\n<p>After some research — figuring out the quality of developer blog posts has become a skill in itself — I had a few good\nideas on how to do this. Ananya’s article<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup> on dev.to was a great starting point, especially since most other articles\ndon’t suggest CSS custom properties (also called variables) for implementing dark mode. </p>\n<p>The most common approach seems to be defining an alternative dark mode global <code class=\"language-text\">&lt;body&gt;</code> class and using Javascript\nbefore the body renders to edit its class to the dark mode explicitly. Since Lumen already makes use of Sass, I went\nwith a mixed approach, keeping Sass variables in the different components and assigning to them the CSS custom\nproperties. </p>\n<p>This has its drawbacks too, as we can’t use Sass color module functions, but the very limited number of colors and page\ntypes of the template allows for pre-setting all the colors we will use. It also has its benefits, since we can\ndirectly use <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CSS attribute selectors</a> and\nHMTL5’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/data-*\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">data-* global attributes</a>. We can\nuse an attribute selector dependent on our data-* attribute, changing the color variables depending on which <code class=\"language-text\">theme</code>\ndata attribute we select.</p>\n<h2 id=\"media-queries-and-setting-a-mode\" style=\"position:relative;\"><a href=\"#media-queries-and-setting-a-mode\" aria-label=\"media queries and setting a mode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Media queries and setting a mode</h2>\n<blockquote>\n<p>Media Queries allow authors to test and query values or features of the user agent or display device, independent of\nthe document being rendered. They are used in the CSS @media rule to conditionally apply styles to a document, and in\nvarious other contexts and languages, such as HTML and JavaScript.</p>\n<p>— <a href=\"https://drafts.csswg.org/mediaqueries-5/#prefers-color-scheme\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Media Queries Level 5 specification</a></p>\n</blockquote>\n<p>We’re connecting another recent feature of CSS formatting, media queries and, more specifically, the <code class=\"language-text\">prefers-color-scheme</code>\nmedia query that informs the browser of the client’s OS dark/light mode preference. With this I can infer the reader’s\npreference for a dark or light mode and use that preference to style the page accordingly. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mql <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">matchMedia</span><span class=\"token punctuation\">(</span><span class=\"token string\">'(prefers-color-scheme: dark)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> hasMediaQueryPreference <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> mql<span class=\"token punctuation\">.</span>matches <span class=\"token operator\">===</span> <span class=\"token string\">'boolean'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasMediaQueryPreference <span class=\"token operator\">&amp;&amp;</span> mql<span class=\"token punctuation\">.</span>matches <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>theme <span class=\"token operator\">=</span> <span class=\"token string\">'dark'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>theme <span class=\"token operator\">=</span> <span class=\"token string\">'light'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">mql</code> should hold a boolean, indicating if the user’s OS color preference is dark mode. Like I mentioned before, I’m\nusing data-* attributes, which means that we can use the <code class=\"language-text\">dataset</code> object of <code class=\"language-text\">documentElement</code>. Subsequently, I set my\nalternative CSS selector to use these data-* attribute:</p>\n<div class=\"gatsby-highlight\" data-language=\"sass\"><pre class=\"language-sass\"><code class=\"language-sass\"><span class=\"token comment\">// Colors, using css variables</span>\n<span class=\"token property-line\"><span class=\"token punctuation\">:</span><span class=\"token property\">root</span> {</span>\n  <span class=\"token comment\">// Based on One Light: https://github.com/atom/one-light-syntax/blob/master/styles/colors.less</span>\n<span class=\"token property-line\">  <span class=\"token property\">--bg-color</span><span class=\"token punctuation\">:</span> rgb(231, 230, 223);</span>\n\n<span class=\"token property-line\">  <span class=\"token property\">--base</span><span class=\"token punctuation\">:</span> rgb(11, 23, 82);</span>\n<span class=\"token property-line\">  <span class=\"token property\">--primary</span><span class=\"token punctuation\">:</span> rgb(134, 69, 28);</span>\n<span class=\"token property-line\">  <span class=\"token property\">--secondary</span><span class=\"token punctuation\">:</span> rgba(11, 23, 82, 70<span class=\"token operator\">%</span>);</span>\n<span class=\"token property-line\">  <span class=\"token property\">--gray</span><span class=\"token punctuation\">:</span> hsl(230, 23<span class=\"token operator\">%</span>, 23<span class=\"token operator\">%</span>);</span>\n<span class=\"token property-line\">  <span class=\"token property\">--gray-border</span><span class=\"token punctuation\">:</span> hsl(230, 77<span class=\"token operator\">%</span>, 13<span class=\"token operator\">%</span>);</span>\n<span class=\"token selector\">}</span>\n\n<span class=\"token selector\">[data-theme=</span><span class=\"token string\">\"dark\"</span><span class=\"token selector\">] {</span>\n  <span class=\"token comment\">// Based on One Dark: https://github.com/atom/atom/blob/master/packages/one-dark-syntax/styles/colors.less</span>\n<span class=\"token property-line\">  <span class=\"token property\">--bg-color</span><span class=\"token punctuation\">:</span> hsl(220, 13<span class=\"token operator\">%</span>, 18<span class=\"token operator\">%</span>);</span>\n\n<span class=\"token property-line\">  <span class=\"token property\">--base</span><span class=\"token punctuation\">:</span> hsl(219, 14<span class=\"token operator\">%</span>, 71<span class=\"token operator\">%</span>); <span class=\"token operator\">/</span><span class=\"token operator\">/</span> mono-1</span>\n<span class=\"token property-line\">  <span class=\"token property\">--primary</span><span class=\"token punctuation\">:</span> hsl( 29, 54<span class=\"token operator\">%</span>, 61<span class=\"token operator\">%</span>); <span class=\"token operator\">/</span><span class=\"token operator\">/</span> orange-1</span>\n<span class=\"token property-line\">  <span class=\"token property\">--secondary</span><span class=\"token punctuation\">:</span> hsl(220, 9<span class=\"token operator\">%</span>, 55<span class=\"token operator\">%</span>); <span class=\"token operator\">/</span><span class=\"token operator\">/</span> mono-2</span>\n<span class=\"token property-line\">  <span class=\"token property\">--gray-border</span><span class=\"token punctuation\">:</span> hsl(220, 10<span class=\"token operator\">%</span>, 40<span class=\"token operator\">%</span>); <span class=\"token operator\">/</span><span class=\"token operator\">/</span> mono-3</span>\n<span class=\"token property-line\">  <span class=\"token property\">--gray</span><span class=\"token punctuation\">:</span> hsl(0, 0<span class=\"token operator\">%</span>, 100<span class=\"token operator\">%</span>); <span class=\"token operator\">/</span><span class=\"token operator\">/</span> white</span>\n<span class=\"token selector\">}</span></code></pre></div>\n<p>As discussed before, depending on the root data attribute, the page will either display the default CSS colors, or the\ndark mode colors.</p>\n<h2 id=\"flash-of-unstyled-content\" style=\"position:relative;\"><a href=\"#flash-of-unstyled-content\" aria-label=\"flash of unstyled content permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flash of Unstyled Content</h2>\n<p>The <a href=\"https://web.archive.org/web/20150513055019/http://www.bluerobot.com/web/css/fouc.asp/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">flash of unstyled content (FOUC)</a>\nis a fairly annoying consequence of sequential DOM building, where a browser will display\nHTML without having fully loaded its CSS. It is especially noticeable on dark/light mode pages when the default flashing\npage mode is different from the expected OS color mode, and getting around this issue is fairly easy with Gatsby.</p>\n<p>In order to avoid this we’ll load and set the preferred media mode (dark or light) using Gatsby’s <code class=\"language-text\">setPreBodyComponents</code>\nfunction in its server side render options. When using this specific starter blog, editing the <code class=\"language-text\">gatsby/on-render-body.js</code>\nfile is where these changes should be placed, since this file is referenced by the Gatsby server side rendering file, <code class=\"language-text\">gastby-ssr.js</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> applyDarkModeFunc <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n(function() {\n  const mode = localStorage.getItem('theme');\n  if (mode !== null &amp;&amp; ['light', 'dark'].includes(mode)) {\n    document.documentElement.dataset.theme = mode;\n    return;\n  }\n\n  const mql = window.matchMedia('(prefers-color-scheme: dark)');\n  const hasMediaQueryPreference = typeof mql.matches === 'boolean';\n  if (hasMediaQueryPreference &amp;&amp; mql.matches === true) {\n    document.documentElement.dataset.theme = 'dark';\n  } else {\n    document.documentElement.dataset.theme = 'light'\n  }\n})();\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onRenderBody</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> setPreBodyComponents <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setPreBodyComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      dangerouslySetInnerHTML<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        __html<span class=\"token operator\">:</span> applyDarkModeFunc<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, before drawing the page body we check for a stored preference in localStorage and return if there is one.\nIf not, we check the OS’s preferred color scheme and set te page theme accordingly.</p>\n<h2 id=\"react-hooks-and-toggler\" style=\"position:relative;\"><a href=\"#react-hooks-and-toggler\" aria-label=\"react hooks and toggler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Hooks and Toggler</h2>\n<p>Finally, we need to create a button to change between dark and light mode. For this we’re using React’s functional\nprogramming hooks, making use of <code class=\"language-text\">useState</code> and <code class=\"language-text\">useEffect</code>. The first will be used to create a theme state variable and\nsetter. Using this theme variable, we’ll register it as a dependency of the useEffect-triggered function, which will be\nrun whenever the theme changes.</p>\n<p>Whenever the button is pressed and the <code class=\"language-text\">toggleTheme</code> function runs, the <code class=\"language-text\">theme</code> variable is changed to the appropriate\nnew value by triggering our anonymous function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'./DarkModeToggler.module.scss'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ThemeToggler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> initTheme <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>theme<span class=\"token punctuation\">,</span> setTheme<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>initTheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'theme'</span><span class=\"token punctuation\">,</span> theme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>theme <span class=\"token operator\">=</span> theme<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">[</span>theme<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">toggleTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newTheme <span class=\"token operator\">=</span> theme <span class=\"token operator\">===</span> <span class=\"token string\">'dark'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'light'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'dark'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setTheme</span><span class=\"token punctuation\">(</span>newTheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">[</span><span class=\"token string\">'toggler'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>label<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>input\n          type<span class=\"token operator\">=</span><span class=\"token string\">\"checkbox\"</span>\n          onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">toggleTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          hidden<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>theme<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> mode</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ThemeToggler<span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"finishing-steps\" style=\"position:relative;\"><a href=\"#finishing-steps\" aria-label=\"finishing steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finishing steps</h2>\n<p>With all of this in place we are pretty much done! Small details like the medium-style zoom provided by\n<code class=\"language-text\">gatsby-remark-images-medium-zoom</code> can be configured in the <code class=\"language-text\">gatsby-config.js</code> page. I’d recommend using a CSS attribute\n(as a string) as the backgroung option, which will make it work with the dark/light mode settings too!</p>\n<p>This is all I needed to do to make this work, feel free to replicate and modify it if you’re looking for the same\nfunctionality. I don’t have any comments section on this blog (on purpose), so feel free to open an issue on this page’s\nrepo or message me through LinkedIn.</p>\n<h3 id=\"post-script-1\" style=\"position:relative;\"><a href=\"#post-script-1\" aria-label=\"post script 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Post Script 1</h3>\n<p>While building and deploying I found a issue with SSR and the React component I built. The issue is that the browser DOM\nmethods aren’t available when building on server side, but following\n<a href=\"https://www.gatsbyjs.com/docs/using-client-side-only-packages/#workaround-4-use-reactlazy-and-suspense-on-client-side-only\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Gatsby’s documentation</a>\nwe can work around the problem. To not have to add another dependency I decided to use React component lazy loading\nand check for the availability of the DOM methods, following the workaround 4 in the linked page.</p>\n<p>These changes were introduced in the component that loads that offending component, <code class=\"language-text\">Sidebar.js</code>, and building now works\ncorrectly, as well as in development mode.</p>\n\n      <div class=\"footnotes\">\n        <hr/><strong>Footnotes:</strong>\n        <ol >\n    \n    <li class=\"footnote-list-item\" id=\"fn-1\" >\n          \n        <p class=\"footnote-paragraph\" style=\"display:inline; \">The code is still available under the <a href=\"https://github.com/joaommartins/joaommartins.github.io/tree/gh-page-staticjinja-based\">gh-page-staticjinja-based</a> branch backing this repo.</p>\n      <a href=\"#fnref-1\" class=\"footnote-backref\" style=\"display:inline;text-decoration: none;\">\n        ^\n      </a>\n    \n      </li>\n      \n    \n\n    <li class=\"footnote-list-item\" id=\"fn-2\" >\n          \n        <p class=\"footnote-paragraph\" style=\"display:inline; \"><a href=\"https://dev.to/ananyaneogi/create-a-dark-light-mode-switch-with-css-variables-34l8\">Article</a> by Ananya Neogi.</p>\n      <a href=\"#fnref-2\" class=\"footnote-backref\" style=\"display:inline;text-decoration: none;\">\n        ^\n      </a>\n    \n      </li>\n      \n    </ol></div>","fields":{"slug":"/posts/gatsby-lumen-and-dark-mode","tagSlugs":["/tag/gatsby/","/tag/react/","/tag/javascript/"]},"frontmatter":{"date":"2021-05-31T20:04:37.121Z","description":"How I implemented dark mode in a Gatsby Lumen using CSS variables","tags":["Gatsby","React","Javascript"],"title":"Gatsby, Lumen and Dark Mode"}}},"pageContext":{"slug":"/posts/gatsby-lumen-and-dark-mode"}},"staticQueryHashes":["1674089512","251939775","401334301"]}